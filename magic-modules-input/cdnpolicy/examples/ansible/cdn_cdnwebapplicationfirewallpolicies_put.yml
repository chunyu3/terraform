--- !ruby/object:Provider::Ansible::Example
task: !ruby/object:Provider::Ansible::Task
  name: azure_rm_cdnpolicy
  description: Creates specific policy
  code:
    resource_group: myResourceGroup
    policy_name: myCdnWebApplicationFirewallPolicy
    cdn_web_application_firewall_policy:
      location: WestUs
      sku:
        name: Standard_Microsoft
      properties:
        policySettings:
          defaultRedirectUrl: 'http://www.bing.com'
          defaultCustomBlockResponseStatusCode: '499'
          defaultCustomBlockResponseBody: >-
            PGh0bWw+CjxoZWFkZXI+PHRpdGxlPkhlbGxvPC90aXRsZT48L2hlYWRlcj4KPGJvZHk+CkhlbGxvIHdvcmxkCjwvYm9keT4KPC9odG1sPg==
        rateLimitRules:
          rules:
            - name: RateLimitRule1
              priority: '1'
              enabledState: Enabled
              rateLimitDurationInMinutes: '0'
              rateLimitThreshold: '1000'
              matchConditions:
                - matchVariable: RemoteAddr
                  selector: null
                  operator: IPMatch
                  negateCondition: false
                  matchValue:
                    - 192.168.1.0/24
                    - 10.0.0.0/24
              action: Block
        customRules:
          rules:
            - name: CustomRule1
              priority: '2'
              enabledState: Enabled
              matchConditions:
                - matchVariable: RemoteAddr
                  selector: null
                  operator: GeoMatch
                  negateCondition: false
                  matchValue:
                    - CH
                - matchVariable: RequestHeader
                  selector: UserAgent
                  operator: Contains
                  negateCondition: false
                  matchValue:
                    - windows
              action: Block
        managedRules:
          managedRuleSets:
            - ruleSetType: DefaultRuleSet
              ruleSetVersion: preview-1.0
              ruleGroupOverrides:
                - ruleGroupName: Group1
                  rules:
                    - ruleId: GROUP1-0001
                      enabledState: Enabled
                      action: Redirect
                    - ruleId: GROUP1-0002
                      enabledState: Disabled
  